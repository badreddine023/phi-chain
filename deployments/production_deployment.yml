version: '3.8'

services:
  phi-node-1:
    image: phi-chain/node:latest
    container_name: phi-node-1
    ports:
      - "8765:8765"
      - "5000:5000"
    environment:
      - NODE_ID=node_001
      - MASTER_PASSWORD=change_me_in_production
    volumes:
      - ./data/node1:/home/ubuntu/phi-chain/data
    restart: always

  phi-node-2:
    image: phi-chain/node:latest
    container_name: phi-node-2
    ports:
      - "8766:8765"
      - "5001:5000"
    environment:
      - NODE_ID=node_002
      - MASTER_PASSWORD=change_me_in_production
    volumes:
      - ./data/node2:/home/ubuntu/phi-chain/data
    restart: always

  phi-node-3:
    image: phi-chain/node:latest
    container_name: phi-node-3
    ports:
      - "8767:8765"
      - "5002:5000"
    environment:
      - NODE_ID=node_003
      - MASTER_PASSWORD=change_me_in_production
    volumes:
      - ./data/node3:/home/ubuntu/phi-chain/data
    restart: always

  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - "3000:3000"
    depends_on:
      - prometheus
